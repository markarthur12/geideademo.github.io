<!DOCTYPE html>
<html>
<head>
<title>GEIDEA PAYMENTS</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oswald">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open Sans">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
h1,h2,h3,h4,h5,h6 {font-family: "Oswald"}
body {font-family: "Open Sans"}

</style>
</head>
<body class="w3-light-grey">

<!-- Navigation bar with social media icons -->
<div class="w3-bar w3-deep-orange w3-hide-small">
  <a href="#" class="w3-bar-item w3-button"><i class="fa fa-facebook-official"></i></a>
  <a href="#" class="w3-bar-item w3-button"><i class="fa fa-instagram"></i></a>
  <a href="#" class="w3-bar-item w3-button"><i class="fa fa-snapchat"></i></a>
  <a href="#" class="w3-bar-item w3-button"><i class="fa fa-flickr"></i></a>
  <a href="#" class="w3-bar-item w3-button"><i class="fa fa-twitter"></i></a>
  <a href="#" class="w3-bar-item w3-button"><i class="fa fa-linkedin"></i></a>
  <a href="#" class="w3-bar-item w3-button w3-right"><i class="fa fa-search"></i></a>
</div>
  
<!-- w3-content defines a container for fixed size centered content, 
and is wrapped around the whole page content, except for the footer in this example -->
<div class="w3-content" style="max-width:1600px">

  <!-- Header -->
  <header class="w3-container  w3-center w3-padding-48 w3-white">
  <img class="w3-image" src="geideanet.png" alt="Geidea" width="200" height="200">
    
  </header>

  <!-- Image header -->
  <header class="w3-display-container w3-wide" id="home">
    <img class="w3-image" src="merchant.png" alt="Geidea" width="1600" height="1060">
    <div class="w3-display-topmiddle w3-padding-large">
      <h6><button id="generateLink" class="w3-button w3-deep-orange w3-padding-large w3-large w3-opacity w3-hover-opacity-off" onclick="document.getElementById('subscribe').style.display='block'">GENERATE PAYMENT LINK</button></h6>
 

   </div>


  </header>

<html>

 <div>
 
 <header class="w3-display-container w3-wide" id="home">

	
	<div>
            <label id="link"  for="link" hidden></label>
        </div>
      <div class="w3-display-topmiddle w3-padding-large">
 <h6><button id="copyLink" class="w3-button w3-gray w3-padding-large w3-large w3-opacity w3-hover-opacity-off" onclick="document.getElementById('subscribe').style.display='block'">COPY THE LINK</button></h6>

</header>
 </div>
 </div>


</html>
<!-- Footer -->
<footer class="w3-container w3-deep-orange" style="padding:32px">
  <a href="#" class="w3-button w3-black w3-padding-large w3-margin-bottom"><i class="fa fa-arrow-up w3-margin-right"></i>To the top</a>
  <p>Powered by <a href="https://geidea.net/merchants/en/" target="_blank">Geidea.net</a></p>
</footer>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js" /></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" /></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.33/moment-timezone-with-data-10-year-range.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#copyLink").click(function () {
                //let string generatedLink = $('#link').text;
                var generatedLink = generatedLink = $('#link').text();
                let urlStart = generatedLink.indexOf('https');
                let urlEnd = generatedLink.indexOf('expiration');
                urlEnd = urlEnd - 3;
                var url = generatedLink.substring(urlStart, urlEnd);
                navigator.clipboard.writeText(url);
                alert("Url Copied successfully");
            });
            $("#generateLink").click(function () {

                $('#link').text("Loading Link...");

                let postObj = {
                    transactionAmount: {
                        total: "10.67",
                        currency: "AED",
                    },
                    orderId: Math.floor((Math.random() * 100000) + 1), //random number
                    transactionType: "SALE",
                    transactionNotificationURL: "https",
                    expiration: "4102358400",
                    authenticateTransaction: true,
                    dynamicMerchantName: "GEIDEA",
                    invoiceNumber: "29062021-011",
                    purchaseOrderNumber: "29062021-031",
                    hostedPaymentPageText: "GEIDEA",
                    billing: {
                        name: "Test Name",
                        birthDate: "1980-01-31",
                        contact: {
                            phone: "1234567890",
                            mobilePhone: "1234567890",
                            fax: "1234567890",
                            email: "sidra.chaudhary@geidea.net",
                        },
                    },
                };

                let post = JSON.stringify(postObj);
                var clientrequestid = generateUUID();

                var timestamp = new Date().getTime();

                //var values = "VlyxQ3ScQ5GziqG6iijNXYZIKWfpO5lJ"+ clientrequestid + timestamp.toString();
                //console.log("Values: ", values);
                //values= "kLQC6q13Zl9SBOjuDHlswOa9Zi51caoPdfa807fa-69d1-4809-a176-1392c4be10941664301489194";
                //console.log("Base64 Conversion: ",btoa(values));

                var values = "VlyxQ3ScQ5GziqG6iijNXYZIKWfpO5lJ" + clientrequestid + timestamp.toString() + post;

                const messageSignature = CryptoJS.HmacSHA256(values, "jzzxbppbnZ2AB6DGVVBdg6ryCvAKzp9kXIGZlU6cKV6");
                const messageSignatureBase64 = CryptoJS.enc.Base64.stringify(messageSignature);


                // debugger;
                //   values= "kLQC6q13Zl9SBOjuDHlswOa9Zi51caoPdfa807fa-69d1-4809-a176-1392c4be10941664301489194";
                //   var hmac = CryptoJS.algo.HMAC.create(CryptoJS.algo.SHA256, "jzzxbppbnZ2AB6DGVVBdg6ryCvAKzp9kXIGZlU6cKV6");
                //   hmac.update(values);
                //   var hash = hmac.finalize();
                //   const messageSignatureBase64 = CryptoJS.enc.Base64.stringify(hash);

                console.log(messageSignatureBase64, "Message Base64");

                const url =
                    "https://prod.emea.api.fiservapps.com/sandbox/ipp/payments-gateway/v2/payment-url";
                let xhr = new XMLHttpRequest();

                xhr.open("POST", url, true);
                xhr.setRequestHeader("Content-type", "application/json; charset=UTF-8")
                xhr.setRequestHeader("Api-Key", "VlyxQ3ScQ5GziqG6iijNXYZIKWfpO5lJ")
                xhr.setRequestHeader("Client-Request-Id", clientrequestid)
                xhr.setRequestHeader("Timestamp", timestamp.toString())
                xhr.setRequestHeader("Message-Signature", messageSignatureBase64)
                xhr.send(post);

                xhr.onload = function () {
                    if (xhr.status === 200) {
                        console.log("Post successfully created!");
                    }
                };
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == XMLHttpRequest.DONE) {
                        //alert(xhr.responseText);
						//document.getElementById("pbl").value=xhr.responseText;
                        $('#copyLink').show();
                         $('#link').text(xhr.responseText);
						 alert("Email has been initited ");
                    }
                }
            });
        });

        function generateUUID() {
            // Public Domain/MIT
            var d = new Date().getTime(); //Timestamp
            var d2 =
                (typeof performance !== "undefined" &&
                    performance.now &&
                    performance.now() * 1000) ||
                0; //Time in microseconds since page-load or 0 if unsupported
            return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(
                /[xy]/g,
                function (c) {
                    var r = Math.random() * 16; //random number between 0 and 16
                    if (d > 0) {
                        //Use timestamp until depleted
                        r = (d + r) % 16 | 0;
                        d = Math.floor(d / 16);
                    } else {
                        //Use microseconds since page-load if supported
                        r = (d2 + r) % 16 | 0;
                        d2 = Math.floor(d2 / 16);
                    }
                    return (c === "x" ? r : (r & 0x3) | 0x8).toString(16);
                }
            );
        }
    </script>


</body>
</html>
